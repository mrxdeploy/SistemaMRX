PROMPT COMPLETO: IMPLEMENTAÃ‡ÃƒO DO MÃ“DULO COMPRADOR MRX - SISTEMA DE PREÃ‡OS POR ESTRELAS
ğŸ¯ CONTEXTO E OBJETIVO
O sistema MRX possui um mÃ³dulo comprador que precisa ser completamente reformulado para trabalhar com:

Lista Ãºnica de materiais base (45+ tipos de sucata eletrÃ´nica)
3 tabelas de preÃ§o por estrelas (1â˜…, 2â˜…, 3â˜…) - cada uma com preÃ§os para TODOS os materiais
VinculaÃ§Ã£o fornecedor â†’ tabela (cada fornecedor tem UMA tabela ativa)
Fluxo de autorizaÃ§Ã£o quando preÃ§o negociado > preÃ§o da tabela
ImportaÃ§Ã£o em massa via Excel
ğŸ“Š ANÃLISE DO QUE JÃ EXISTE VS O QUE FALTA
âœ… O que JÃ estÃ¡ implementado:
Sistema de tipos de lote (tipos_lote)
Tabela tipo_lote_precos (classificaÃ§Ã£o + estrelas + preÃ§o)
RelaÃ§Ã£o FornecedorTipoLoteClassificacao (mapeia classificaÃ§Ã£o â†’ estrelas por fornecedor)
ImportaÃ§Ã£o/exportaÃ§Ã£o Excel de tipos de lote
Tela /tipos-lote.html com grid 3Ã—5 de preÃ§os
âŒ O que FALTA implementar:
Tabela unificada de materiais base (45+ itens da lista fornecida)
3 tabelas de preÃ§o independentes (1â˜…, 2â˜…, 3â˜…) com preÃ§os para cada material
VinculaÃ§Ã£o fornecedor â†’ tabela de preÃ§o
Sistema de autorizaÃ§Ã£o de preÃ§o quando comprador negocia acima da tabela
ReformulaÃ§Ã£o da tela /tipos-lote.html para trabalhar com o novo modelo
ImportaÃ§Ã£o consolidada (1 Excel com 3 colunas de preÃ§o: 1â˜…, 2â˜…, 3â˜…)
ğŸ—‚ï¸ ETAPA 1: MIGRAÃ‡ÃƒO DO SCHEMA DE DADOS
1.1 Criar Nova Tabela materiais_base
Objetivo: Substituir/complementar tipos_lote com lista fixa de 45+ materiais.

CREATE TABLE materiais_base (
    id SERIAL PRIMARY KEY,
    codigo VARCHAR(20) UNIQUE NOT NULL,  -- Gerado automaticamente: MAT001, MAT002...
    nome VARCHAR(200) UNIQUE NOT NULL,   -- Ex: "SUCATA PROCESSADOR CERÃ‚MICO A"
    classificacao VARCHAR(10) NOT NULL,  -- 'leve', 'medio', 'pesado' (fixo por material)
    descricao TEXT,
    ativo BOOLEAN DEFAULT TRUE,
    data_cadastro TIMESTAMP DEFAULT NOW(),
    data_atualizacao TIMESTAMP DEFAULT NOW(),
    CONSTRAINT chk_classificacao CHECK (classificacao IN ('leve', 'medio', 'pesado'))
);
CREATE INDEX idx_materiais_base_nome ON materiais_base(nome);
CREATE INDEX idx_materiais_base_classificacao ON materiais_base(classificacao);
Regras:

CÃ³digo Ã© gerado automaticamente: MAT001, MAT002, etc.
Cada material tem classificaÃ§Ã£o fixa (nÃ£o muda por fornecedor)
Limite de 500 materiais cadastrados
1.2 Criar Sistema de Tabelas de PreÃ§o por Estrelas
Estrutura hierÃ¡rquica:

tabelas_preco (3 registros fixos: 1â˜…, 2â˜…, 3â˜…)
    â””â”€â”€ tabela_preco_itens (todos os materiais Ã— 3 tabelas)
-- Tabela mestre (apenas 3 registros)
CREATE TABLE tabelas_preco (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(50) UNIQUE NOT NULL,  -- "Tabela 1 Estrela", "Tabela 2 Estrelas", "Tabela 3 Estrelas"
    nivel_estrelas INTEGER UNIQUE NOT NULL CHECK (nivel_estrelas IN (1, 2, 3)),
    ativo BOOLEAN DEFAULT TRUE,
    data_criacao TIMESTAMP DEFAULT NOW()
);
-- PreÃ§os especÃ­ficos: material Ã— tabela
CREATE TABLE tabela_preco_itens (
    id SERIAL PRIMARY KEY,
    tabela_preco_id INTEGER NOT NULL REFERENCES tabelas_preco(id) ON DELETE CASCADE,
    material_id INTEGER NOT NULL REFERENCES materiais_base(id) ON DELETE CASCADE,
    preco_por_kg DECIMAL(10,2) NOT NULL DEFAULT 0.00 CHECK (preco_por_kg >= 0),
    ativo BOOLEAN DEFAULT TRUE,
    data_atualizacao TIMESTAMP DEFAULT NOW(),
    CONSTRAINT uq_tabela_material UNIQUE (tabela_preco_id, material_id)
);
CREATE INDEX idx_tabela_preco_itens_tabela ON tabela_preco_itens(tabela_preco_id);
CREATE INDEX idx_tabela_preco_itens_material ON tabela_preco_itens(material_id);
Trigger automÃ¡tico: Quando criar novo material, inserir 3 registros em tabela_preco_itens (um para cada tabela).

1.3 Vincular Fornecedor a Tabela de PreÃ§o
ALTER TABLE fornecedores 
ADD COLUMN tabela_preco_id INTEGER REFERENCES tabelas_preco(id) DEFAULT 1,  -- Default: Tabela 1â˜…
ADD COLUMN comprador_responsavel_id INTEGER REFERENCES usuarios(id);
Regras:

Fornecedor novo sempre comeÃ§a com tabela_preco_id = 1 (Tabela 1â˜…)
Apenas ADM pode alterar tabela_preco_id
MudanÃ§a de tabela gera registro em auditoria_logs
1.4 Sistema de AutorizaÃ§Ã£o de PreÃ§o
CREATE TABLE solicitacoes_autorizacao_preco (
    id SERIAL PRIMARY KEY,
    compra_id INTEGER REFERENCES compras(id),  -- Pode ser NULL inicialmente
    fornecedor_id INTEGER NOT NULL REFERENCES fornecedores(id),
    comprador_id INTEGER NOT NULL REFERENCES usuarios(id),
    material_id INTEGER NOT NULL REFERENCES materiais_base(id),
    peso_kg DECIMAL(10,2) NOT NULL,
    
    -- Snapshot da tabela no momento da solicitaÃ§Ã£o
    tabela_atual_id INTEGER NOT NULL REFERENCES tabelas_preco(id),
    preco_tabela DECIMAL(10,2) NOT NULL,  -- Valor que estava na tabela
    preco_negociado DECIMAL(10,2) NOT NULL,  -- Valor que o comprador quer
    diferenca_percentual DECIMAL(5,2),  -- Calculado: ((negociado - tabela) / tabela) * 100
    
    justificativa TEXT NOT NULL,
    status VARCHAR(20) DEFAULT 'pendente' CHECK (status IN ('pendente', 'aprovada', 'rejeitada')),
    
    -- DecisÃ£o do ADM
    decisao_adm_id INTEGER REFERENCES usuarios(id),
    nova_tabela_atribuida_id INTEGER REFERENCES tabelas_preco(id),  -- Se ADM promoveu fornecedor
    motivo_decisao TEXT,
    
    data_solicitacao TIMESTAMP DEFAULT NOW(),
    data_decisao TIMESTAMP,
    
    CONSTRAINT chk_preco_negociado_maior CHECK (preco_negociado > preco_tabela)
);
CREATE INDEX idx_autorizacao_status ON solicitacoes_autorizacao_preco(status);
CREATE INDEX idx_autorizacao_comprador ON solicitacoes_autorizacao_preco(comprador_id);
ğŸ“ ETAPA 2: POPULAR DADOS INICIAIS
2.1 Script seed_materiais_base.py
Cadastrar os 45+ materiais da lista fornecida:

materiais = [
    {"nome": "SUCATA PROCESSADOR CERÃ‚MICO A", "classificacao": "pesado"},
    {"nome": "SUCATA PROCESSADOR CERÃ‚MICO B", "classificacao": "pesado"},
    {"nome": "SUCATA PROCESSADOR CERÃ‚MICO C", "classificacao": "pesado"},
    {"nome": "SUCATA PROCESSADOR SLOT", "classificacao": "pesado"},
    {"nome": "SUCATA PROCESSADOR PLÃSTICO A", "classificacao": "leve"},
    {"nome": "SUCATA PROCESSADOR PLÃSTICO B", "classificacao": "leve"},
    {"nome": "SUCATA PLACA MÃƒE SERVIDOR", "classificacao": "pesado"},
    {"nome": "SUCATA PLACA MÃƒE DESKTOP", "classificacao": "medio"},
    {"nome": "SUCATA PLACA MÃƒE NOTEBOOK", "classificacao": "medio"},
    {"nome": "SUCATA MEMÃ“RIA RAM DDR", "classificacao": "pesado"},
    {"nome": "SUCATA HD SATA", "classificacao": "medio"},
    {"nome": "SUCATA SSD", "classificacao": "pesado"},
    {"nome": "SUCATA FONTE ATX", "classificacao": "leve"},
    {"nome": "SUCATA CABO FLAT", "classificacao": "leve"},
    # ... continuar com TODOS os 45+ materiais da imagem NOMENCLATURA
]
# Para cada material:
# 1. Gerar cÃ³digo (MAT001, MAT002...)
# 2. Inserir em materiais_base
# 3. Criar 3 preÃ§os (um para cada tabela, inicialmente 0.00)
2.2 Script seed_tabelas_preco.py
Criar as 3 tabelas fixas:

tabelas = [
    {"nome": "Tabela 1 Estrela", "nivel_estrelas": 1},
    {"nome": "Tabela 2 Estrelas", "nivel_estrelas": 2},
    {"nome": "Tabela 3 Estrelas", "nivel_estrelas": 3}
]
ğŸ¨ ETAPA 3: REFORMULAR TELA /tipos-lote.html
3.1 Renomear para /materiais-base.html
Novo tÃ­tulo: "GestÃ£o de Materiais Base"

3.2 Novo Layout da Tela
CabeÃ§alho:

[â† Voltar] GestÃ£o de Materiais Base
[+ Novo Material] [ğŸ“¥ Importar Excel] [ğŸ“¤ Exportar] [ğŸ“‹ Modelo]
Filtros:

[Buscar material...] [ClassificaÃ§Ã£o: Todos â–¼] [Status: Ativos â–¼]
Tabela Principal:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ³digo   â”‚ Nome do Material            â”‚ ClassificaÃ§Ã£oâ”‚ 1â˜… R$/kg â”‚ 2â˜… R$/kg â”‚ 3â˜… R$/kg â”‚ Ativoâ”‚ AÃ§Ãµes  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MAT001   â”‚ SUCATA PROC. CERÃ‚MICO A    â”‚ Pesado       â”‚ 12,50    â”‚ 15,00    â”‚ 18,50    â”‚ âœ“    â”‚ [Editarâ”‚
â”‚ MAT002   â”‚ SUCATA PLACA MÃƒE SERVIDOR  â”‚ Pesado       â”‚  8,30    â”‚ 10,00    â”‚ 12,00    â”‚ âœ“    â”‚ [Editarâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Modal "Novo Material":

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Novo Material                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nome: [_____________________________]   â”‚
â”‚ CÃ³digo: MAT045 (gerado automaticamente) â”‚
â”‚                                         â”‚
â”‚ ClassificaÃ§Ã£o: (â€¢) Leve                 â”‚
â”‚                ( ) MÃ©dio                â”‚
â”‚                ( ) Pesado               â”‚
â”‚                                         â”‚
â”‚ DescriÃ§Ã£o:                              â”‚
â”‚ [_________________________________]     â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€ PreÃ§os Iniciais (R$/kg) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Tabela 1â˜…: [_____]                â”‚  â”‚
â”‚ â”‚ Tabela 2â˜…: [_____]                â”‚  â”‚
â”‚ â”‚ Tabela 3â˜…: [_____]                â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚ [Cancelar] [Salvar Material]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“¥ ETAPA 4: IMPORTAÃ‡ÃƒO EM MASSA VIA EXCEL
4.1 Formato do Excel Consolidado
Aba Ãºnica: "Materiais e PreÃ§os"

Nome do Material	ClassificaÃ§Ã£o	1 Estrela (R$/kg)	2 Estrelas (R$/kg)	3 Estrelas (R$/kg)	DescriÃ§Ã£o
SUCATA PROCESSADOR CERÃ‚MICO A	pesado	12.50	15.00	18.50	Proc tipo A
SUCATA PLACA MÃƒE SERVIDOR	pesado	8.30	10.00	12.00	Placas serv
LÃ³gica de importaÃ§Ã£o:

Buscar material pelo nome
Se nÃ£o existe: criar novo material + 3 preÃ§os
Se existe: atualizar classificaÃ§Ã£o + 3 preÃ§os
Retornar relatÃ³rio:
Materiais criados: X
Materiais atualizados: Y
PreÃ§os atualizados: Z
Erros: [lista]
ğŸ”§ ETAPA 5: CRIAR NOVA TELA /tabelas-preco.html (apenas ADM)
Layout com Abas:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GestÃ£o de Tabelas de PreÃ§o                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Tabela 1â˜…] [Tabela 2â˜…] [Tabela 3â˜…]   <-- ABAS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ [Buscar material...] [ClassificaÃ§Ã£o: â–¼]          â”‚
â”‚ [ğŸ“¥ Importar PreÃ§os] [ğŸ“¤ Exportar]                â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Material                    â”‚ R$/kg â”‚ Editarâ”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ SUCATA PROC. CERÃ‚MICO A     â”‚ 12.50 â”‚ [âœï¸]  â”‚   â”‚
â”‚ â”‚ SUCATA PLACA MÃƒE SERVIDOR   â”‚  8.30 â”‚ [âœï¸]  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                    â”‚
â”‚ Total: 45 materiais cadastrados                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EdiÃ§Ã£o inline: Clicar no preÃ§o e editar diretamente (salva via AJAX).

ğŸ”„ ETAPA 6: FLUXO DE COMPRA COM AUTORIZAÃ‡ÃƒO
6.1 Modificar Wizard de Nova Compra
Passo 3 - Adicionar Materiais:

// Ao adicionar material:
1. Buscar material em materiais_base
2. Buscar fornecedor.tabela_preco_id
3. Buscar preco em tabela_preco_itens WHERE tabela_id = fornecedor.tabela_preco_id AND material_id = X
4. Mostrar preÃ§o da tabela ao comprador
5. Comprador informa peso + preÃ§o negociado
6. Sistema compara:
   SE preco_negociado <= preco_tabela:
      âœ… Item aprovado automaticamente
   SENÃƒO:
      âš ï¸ Criar solicitacao_autorizacao_preco (status: pendente)
Interface visual:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Material: SUCATA PROC. CERÃ‚MICO A      â”‚
â”‚ Tabela do fornecedor: 2 Estrelas      â”‚
â”‚ PreÃ§o tabela: R$ 15,00/kg             â”‚
â”‚                                        â”‚
â”‚ Peso: [___] kg                        â”‚
â”‚ PreÃ§o negociado: R$ [____]/kg         â”‚
â”‚                                        â”‚
â”‚ âš ï¸ PreÃ§o R$ 2,50 acima da tabela!     â”‚
â”‚    DiferenÃ§a: +16,7%                   â”‚
â”‚                                        â”‚
â”‚ Justificativa obrigatÃ³ria:             â”‚
â”‚ [_____________________________]       â”‚
â”‚                                        â”‚
â”‚ Status: AGUARDANDO APROVAÃ‡ÃƒO ADM       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âš–ï¸ ETAPA 7: TELA DE AUTORIZAÃ‡Ã•ES (ADM)
7.1 Nova Tela /autorizacoes-preco.html
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AutorizaÃ§Ãµes de PreÃ§o Pendentes (3)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Pendentes: 3] [Aprovadas: 12] [Rejeitadas: 2] â”‚
â”‚                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ“‹ #1245 - 17/11/2025 14:32             â”‚   â”‚
â”‚ â”‚ Comprador: JoÃ£o Silva                    â”‚   â”‚
â”‚ â”‚ Fornecedor: EletrÃ´nicos ABC (Tabela 1â˜…)  â”‚   â”‚
â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ Material: PROC CERÃ‚MICO A                â”‚   â”‚
â”‚ â”‚ Peso: 5 kg                               â”‚   â”‚
â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ PreÃ§o Tabela 1â˜…: R$ 12,50/kg            â”‚   â”‚
â”‚ â”‚ PreÃ§o Negociado: R$ 15,00/kg            â”‚   â”‚
â”‚ â”‚ DiferenÃ§a: +R$ 2,50 (+20%)              â”‚   â”‚
â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ Justificativa:                           â”‚   â”‚
â”‚ â”‚ "Material de altÃ­ssima qualidade..."     â”‚   â”‚
â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ [âŒ Rejeitar] [âœ… Aprovar]               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Modal de AprovaÃ§Ã£o:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aprovar SolicitaÃ§Ã£o #1245           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ( ) Aprovar APENAS esta compra     â”‚
â”‚     (fornecedor continua na 1â˜…)    â”‚
â”‚                                    â”‚
â”‚ (â€¢) Aprovar e PROMOVER fornecedor  â”‚
â”‚     para: ( ) Tabela 2â˜…            â”‚
â”‚           (â€¢) Tabela 3â˜…            â”‚
â”‚                                    â”‚
â”‚ ObservaÃ§Ãµes:                       â”‚
â”‚ [__________________________]      â”‚
â”‚                                    â”‚
â”‚ [Cancelar] [Confirmar]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“Š ETAPA 8: ENDPOINTS DA API
Backend - Materiais Base (app/routes/materiais_base.py)
GET    /api/materiais-base
GET    /api/materiais-base/{id}
POST   /api/materiais-base
PUT    /api/materiais-base/{id}
DELETE /api/materiais-base/{id}
POST   /api/materiais-base/importar-excel
GET    /api/materiais-base/exportar-excel
GET    /api/materiais-base/modelo-importacao
Backend - Tabelas de PreÃ§o (app/routes/tabelas_preco.py)
GET    /api/tabelas-preco
GET    /api/tabelas-preco/{id}/precos
PUT    /api/tabelas-preco/{id}/precos (atualizaÃ§Ã£o em massa)
PUT    /api/tabelas-preco/{id}/precos/{material_id} (individual)
POST   /api/tabelas-preco/{id}/importar-excel
GET    /api/tabelas-preco/{id}/exportar-excel
Backend - AutorizaÃ§Ãµes (app/routes/autorizacoes_preco.py)
GET    /api/autorizacoes-preco
POST   /api/autorizacoes-preco/{id}/aprovar
POST   /api/autorizacoes-preco/{id}/rejeitar
âœ… CHECKLIST FINAL DE IMPLEMENTAÃ‡ÃƒO
[ ] MigraÃ§Ã£o 1: Criar tabela materiais_base
[ ] MigraÃ§Ã£o 2: Criar tabela tabelas_preco
[ ] MigraÃ§Ã£o 3: Criar tabela tabela_preco_itens
[ ] MigraÃ§Ã£o 4: Criar tabela solicitacoes_autorizacao_preco
[ ] MigraÃ§Ã£o 5: ALTER TABLE fornecedores (adicionar tabela_preco_id)
[ ] Seed: Cadastrar 45+ materiais da lista
[ ] Seed: Criar 3 tabelas de preÃ§o (1â˜…, 2â˜…, 3â˜…)
[ ] Seed: Popular tabela_preco_itens (todos materiais Ã— 3 tabelas)
[ ] Backend: CRUD de materiais_base.py
[ ] Backend: CRUD de tabelas_preco.py
[ ] Backend: CRUD de autorizacoes_preco.py
[ ] Frontend: Reformular /tipos-lote.html â†’ /materiais-base.html
[ ] Frontend: Criar /tabelas-preco.html (apenas ADM)
[ ] Frontend: Criar /autorizacoes-preco.html (apenas ADM)
[ ] IntegraÃ§Ã£o: Modificar wizard de compra (validar preÃ§o vs tabela)
[ ] NotificaÃ§Ãµes: ADM recebe quando hÃ¡ nova solicitaÃ§Ã£o pendente
[ ] Auditoria: Registrar mudanÃ§as de tabela de fornecedores
[ ] Excel: Template de importaÃ§Ã£o consolidado (3 colunas de preÃ§o)
[ ] Testes: Importar Excel com 10 materiais
[ ] Testes: Compra com preÃ§o dentro da tabela (auto-aprovaÃ§Ã£o)
[ ] Testes: Compra com preÃ§o acima (gera solicitaÃ§Ã£o)
[ ] Testes: ADM aprovar sem promover fornecedor
[ ] Testes: ADM aprovar promovendo fornecedor (1â˜… â†’ 2â˜…)
ğŸ¯ RESULTADO FINAL ESPERADO
Comprador seleciona material de lista fixa de 45+ itens
Sistema mostra preÃ§o da tabela vinculada ao fornecedor
Se preÃ§o negociado â‰¤ tabela: aprovaÃ§Ã£o automÃ¡tica
Se preÃ§o negociado > tabela: gera solicitaÃ§Ã£o para ADM
ADM pode aprovar e opcionalmente promover fornecedor (ex: 1â˜… â†’ 3â˜…)
ImportaÃ§Ã£o Excel consolidada: 1 arquivo, 3 colunas de preÃ§o