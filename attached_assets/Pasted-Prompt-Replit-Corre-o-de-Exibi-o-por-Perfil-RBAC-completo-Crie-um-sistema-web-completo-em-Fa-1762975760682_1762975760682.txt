Prompt Replit â€“ CorreÃ§Ã£o de ExibiÃ§Ã£o por Perfil (RBAC completo)
Crie um sistema web completo em **FastAPI (backend)** + **React (frontend)** com base no projeto **MRX_GestÃ£o**, garantindo que **cada tipo de perfil** visualize apenas o conteÃºdo e as opÃ§Ãµes que se enquadram em suas permissÃµes, conforme as regras descritas abaixo.

O sistema jÃ¡ possui autenticaÃ§Ã£o JWT e cadastro de perfis.  
O objetivo deste prompt Ã© corrigir a exibiÃ§Ã£o de telas e rotas para que **nenhum perfil veja elementos indevidos**.

---

## ğŸ”’ CONTEXTO DE PERMISSÃ•ES (baseado em MRX_GestÃ£o.md)

### ğŸ‘‘ Administrador
- Acesso total a todos os mÃ³dulos.  
- Pode criar/editar usuÃ¡rios e perfis, importar tabelas de preÃ§o, aprovar exceÃ§Ãµes e divergÃªncias, autorizar descarte e fechar inventÃ¡rio.  
- Visualiza dashboards, auditoria e logs completos.  

### ğŸ§¾ Comprador (PJ)
- Pode **abrir solicitaÃ§Ãµes de compra** e **cadastrar fornecedores**.  
- Visualiza apenas suas prÃ³prias solicitaÃ§Ãµes, histÃ³rico e cotaÃ§Ãµes.  
- NÃ£o pode acessar mÃ³dulos de estoque, separaÃ§Ã£o, financeiro, auditoria nem gestÃ£o de usuÃ¡rios.  

### âš–ï¸ Conferente / Estoque
- Acesso apenas Ã s telas de **recebimento**, **pesagem** e **entrada em estoque**.  
- Pode criar lotes, apontar divergÃªncias e finalizar conferÃªncias.  
- NÃ£o pode ver solicitaÃ§Ãµes de compra, NF-e, auditoria nem usuÃ¡rios.  

### ğŸ§± SeparaÃ§Ã£o
- Pode acessar **Ã¡rea de separaÃ§Ã£o de materiais**, gerando sublotes e classificando resÃ­duos para descarte (com autorizaÃ§Ã£o ADM).  
- NÃ£o tem acesso a compras, financeiro, BI ou auditoria.  

### ğŸš› Motorista
- Acesso apenas ao **aplicativo mÃ³vel ou tela de rotas**.  
- Visualiza **suas coletas**, **histÃ³rico de entregas** e pode enviar comprovantes/fotos.  
- Nenhum acesso a cadastros, estoque ou dashboards.  

### ğŸ’° Financeiro
- Acesso apenas ao **mÃ³dulo de faturamento e contas a pagar/receber**.  
- Pode emitir NF-e, realizar cancelamentos e controlar pagamentos.  
- NÃ£o pode criar usuÃ¡rios, editar perfis ou visualizar rotas.  

### ğŸ“Š Auditoria / BI
- Acesso somente leitura a **painÃ©is, relatÃ³rios e trilhas de auditoria**.  
- Nenhuma permissÃ£o de escrita.  
- NÃ£o pode ver telas operacionais (compras, estoque, motorista, etc.).  

---

## âš™ï¸ OBJETIVO DO PROMPT

Corrigir o **sistema de controle de acesso do frontend e backend**, para que:
1. Cada **perfil** carregue **somente as telas e menus que lhe correspondem**.  
2. Rotas nÃ£o permitidas sejam **bloqueadas no backend (FastAPI)** e **ocultadas no frontend (React)**.  
3. O layout e o menu lateral (sidebar/navbar) sejam **gerados dinamicamente** com base nas permissÃµes do token JWT.  
4. O backend envie o **perfil e claims** no payload JWT (ex: `"perfil": "financeiro"`).  
5. O frontend use esse payload para renderizar apenas os componentes autorizados.  
6. O roteamento (React Router) valide permissÃµes antes de montar a pÃ¡gina.  
7. Se um usuÃ¡rio tentar acessar algo proibido, deve ser redirecionado para `/acesso-negado`.  

---

## ğŸ§± IMPLEMENTAÃ‡ÃƒO ESPERADA

### ğŸ”¹ Backend (FastAPI)
- Atualizar middleware de autorizaÃ§Ã£o:
  - Extrair `perfil` do token JWT.
  - Validar permissÃµes conforme dicionÃ¡rio de regras.
  - Bloquear endpoints nÃ£o compatÃ­veis (`403`).
- Endpoint `/me` deve retornar:
  ```json
  {
    "id": 1,
    "nome": "Carlos Eduardo",
    "email": "admin@mrx.com.br",
    "perfil": "administrador",
    "permissoes": ["usuarios.read", "fornecedores.write", "nfe.emitir"]
  }

ğŸ”¹ Frontend (React)

Criar contexto AuthContext com informaÃ§Ãµes do usuÃ¡rio (perfil e permissÃµes).

Implementar ProtectedRoute:

<ProtectedRoute allowed={['administrador', 'financeiro']}>
  <Financeiro />
</ProtectedRoute>


Gerar menus dinamicamente:

const menu = {
  administrador: ['UsuÃ¡rios', 'Perfis', 'Fornecedores', 'Produtos', 'Financeiro', 'Auditoria'],
  comprador: ['Minhas SolicitaÃ§Ãµes', 'Cadastrar Fornecedor'],
  conferente: ['Recebimento', 'Pesagem', 'Lotes'],
  separacao: ['Separar Materiais', 'Descarte'],
  motorista: ['Minhas Rotas', 'HistÃ³rico de Coletas'],
  financeiro: ['Faturamento', 'Pagamentos'],
  auditoria: ['PainÃ©is', 'Logs de Auditoria']
};


Sidebar deve ser renderizada com base em menu[perfilAtual].

ğŸ”¹ Interface / UI

Cada perfil deve abrir diretamente em sua tela padrÃ£o inicial, sem mostrar menus indevidos:

Perfil	Tela inicial
Administrador	Dashboard geral
Comprador	Minhas SolicitaÃ§Ãµes
Conferente	ConferÃªncia de Recebimento
SeparaÃ§Ã£o	Ãrea de SeparaÃ§Ã£o
Motorista	Minhas Rotas
Financeiro	Faturamento
Auditoria	PainÃ©is e Logs

Adicionar rota de fallback /acesso-negado com mensagem:
"VocÃª nÃ£o tem permissÃ£o para acessar esta Ã¡rea."

ğŸ§© RESULTADO ESPERADO

âœ… Perfis limitados apenas Ã s suas telas e aÃ§Ãµes.
âœ… Menus e rotas geradas dinamicamente conforme JWT.
âœ… Nenhum usuÃ¡rio vÃª opÃ§Ãµes fora do seu escopo.
âœ… ProteÃ§Ã£o de rotas no backend e frontend.
âœ… PadrÃ£o profissional e seguro, seguindo o blueprint MRX_GestÃ£o.