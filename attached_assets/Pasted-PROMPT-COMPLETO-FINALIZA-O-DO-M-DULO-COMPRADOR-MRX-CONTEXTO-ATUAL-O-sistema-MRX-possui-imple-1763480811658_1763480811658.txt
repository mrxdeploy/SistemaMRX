PROMPT COMPLETO - FINALIZAÃ‡ÃƒO DO MÃ“DULO COMPRADOR MRX
ğŸ¯ CONTEXTO ATUAL
O sistema MRX possui implementado:

âœ… Backend completo: MaterialBase, TabelaPreco, TabelaPrecoItem, SolicitacaoAutorizacaoPreco
âœ… APIs REST funcionais: /api/materiais-base, /api/tabelas-preco, /api/autorizacoes-preco
âœ… Seed database: 50 materiais + 3 tabelas de preÃ§o + 150 itens de preÃ§o
âœ… Sistema de autorizaÃ§Ã£o: Quando preÃ§o negociado > tabela
âœ… Excel import/export: Materiais e preÃ§os
âŒ O QUE AINDA FALTA IMPLEMENTAR
1. REFORMULAÃ‡ÃƒO COMPLETA DE /tipos-lote.html
OBJETIVO: Transformar a tela atual em um sistema completo de gestÃ£o de preÃ§os por classificaÃ§Ã£o Ã— estrelas.

1.1. Nova Estrutura da Tela
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ  Header] Tipos de Lote - MRX Systems                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ Novo Material] [ğŸ“¥ Importar Excel] [ğŸ“¤ Exportar]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Buscar: [___________] ClassificaÃ§Ã£o: [Todas â–¼]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LISTA DE MATERIAIS (Card-based, mobile-friendly)       â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ MAT001 - SUCATA PROCESSADOR CERÃ‚MICO A         â”‚    â”‚
â”‚  â”‚ ClassificaÃ§Ã£o: Pesado                           â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ PREÃ‡OS (R$/kg):                                 â”‚    â”‚
â”‚  â”‚ â­ 1â˜…: R$ 12,50 | 2â˜…: R$ 15,00 | 3â˜…: R$ 18,50  â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ âœï¸ Editar PreÃ§os] [ğŸ“Š Ver HistÃ³rico]           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                          â”‚
â”‚  [... mais materiais ...]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
1.2. Modal de EdiÃ§Ã£o de Material
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœï¸ Editar Material: MAT001                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nome: [SUCATA PROCESSADOR CERÃ‚MICO A               ]  â”‚
â”‚  CÃ³digo: [MAT001] (gerado automaticamente)             â”‚
â”‚  ClassificaÃ§Ã£o: [Pesado â–¼]                             â”‚
â”‚  DescriÃ§Ã£o: [________________________________]          â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ’° TABELA DE PREÃ‡OS (R$/kg)                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚            1â˜…        2â˜…        3â˜…                â”‚  â”‚
â”‚  â”‚  [12.50]   [15.00]   [18.50]                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  [Cancelar] [ğŸ’¾ Salvar]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
1.3. JavaScript da Tela
Funcionalidades necessÃ¡rias:

// 1. Carregar materiais com seus preÃ§os
async function carregarMateriais() {
    const response = await fetch('/api/materiais-base', {
        headers: { 'Authorization': `Bearer ${token}` }
    });
    const materiais = await response.json();
    renderizarCards(materiais);
}
// 2. Editar preÃ§os de um material
async function editarMaterial(id) {
    // Buscar material com preÃ§os
    const material = await buscarMaterial(id);
    
    // Preencher modal com:
    // - Nome, cÃ³digo, classificaÃ§Ã£o
    // - 3 inputs de preÃ§o (1â˜…, 2â˜…, 3â˜…)
    preencherModal(material);
}
// 3. Salvar alteraÃ§Ãµes
async function salvarMaterial(id) {
    const dados = {
        nome: document.getElementById('nome').value,
        classificacao: document.getElementById('classificacao').value,
        descricao: document.getElementById('descricao').value,
        precos: {
            preco_1_estrela: parseFloat($('#preco_1').val()),
            preco_2_estrela: parseFloat($('#preco_2').val()),
            preco_3_estrela: parseFloat($('#preco_3').val())
        }
    };
    
    await fetch(`/api/materiais-base/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(dados)
    });
}
2. FLUXO DE SOLICITAÃ‡ÃƒO DE COMPRA COM VALIDAÃ‡ÃƒO AUTOMÃTICA
OBJETIVO: Integrar o sistema de materiais base no fluxo de solicitaÃ§Ãµes.

2.1. Nova Tela de SolicitaÃ§Ã£o de Compra
LocalizaÃ§Ã£o: /templates/funcionario.html ou criar /templates/compra-rapida.html

Fluxo:

1. Comprador seleciona FORNECEDOR
   â†“
2. Sistema busca TABELA DE PREÃ‡O do fornecedor (1â˜…, 2â˜… ou 3â˜…)
   â†“
3. Comprador adiciona materiais:
   - Seleciona material da lista (50+ tipos)
   - Informa PESO (kg)
   - Sistema CALCULA VALOR automaticamente (peso Ã— preÃ§o_tabela)
   â†“
4. Comprador pode ALTERAR o preÃ§o negociado
   â†“
5. Sistema COMPARA:
   - Se preÃ§o â‰¤ tabela â†’ âœ… APROVADO automaticamente
   - Se preÃ§o > tabela â†’ âš ï¸ SOLICITA AUTORIZAÃ‡ÃƒO ADM
   â†“
6. Se houver itens pendentes de autorizaÃ§Ã£o:
   - Mostra alerta: "2 itens aguardam aprovaÃ§Ã£o do ADM"
   - Cria registros em SolicitacaoAutorizacaoPreco
   - Envia notificaÃ§Ã£o WebSocket para admins
2.2. CÃ³digo da Tela
// Passo 1: Selecionar fornecedor e carregar tabela
async function selecionarFornecedor(fornecedorId) {
    const response = await fetch(`/api/fornecedores/${fornecedorId}`);
    const fornecedor = await response.json();
    
    // Exibir tabela vigente
    document.getElementById('tabelaVigente').textContent = 
        `Tabela ${fornecedor.tabela_preco_estrelas}â˜…`;
    
    currentTabelaId = fornecedor.tabela_preco_id;
}
// Passo 2: Adicionar material
async function adicionarMaterial() {
    const materialId = document.getElementById('material').value;
    const peso = parseFloat(document.getElementById('peso').value);
    
    // Buscar preÃ§o da tabela
    const response = await fetch(
        `/api/tabelas-preco/${currentTabelaId}/precos`
    );
    const precos = await response.json();
    const precoItem = precos.find(p => p.material_id == materialId);
    
    const valorAutomatico = peso * precoItem.preco_por_kg;
    
    // Adicionar Ã  lista
    itensCompra.push({
        material_id: materialId,
        material_nome: precoItem.material_nome,
        peso_kg: peso,
        preco_tabela: precoItem.preco_por_kg,
        preco_negociado: valorAutomatico,
        valor_total: valorAutomatico
    });
    
    renderizarLista();
}
// Passo 3: Validar ao finalizar
async function finalizarCompra() {
    const itensComAutorizacao = [];
    const itensAprovados = [];
    
    for (const item of itensCompra) {
        if (item.preco_negociado > item.preco_tabela) {
            itensComAutorizacao.push(item);
        } else {
            itensAprovados.push(item);
        }
    }
    
    if (itensComAutorizacao.length > 0) {
        // Criar solicitaÃ§Ãµes de autorizaÃ§Ã£o
        for (const item of itensComAutorizacao) {
            await criarSolicitacaoAutorizacao(item);
        }
        
        alert(`${itensComAutorizacao.length} itens enviados para aprovaÃ§Ã£o do ADM`);
    }
    
    // Criar solicitaÃ§Ã£o com itens aprovados
    if (itensAprovados.length > 0) {
        await criarSolicitacao(itensAprovados);
    }
}
3. DASHBOARD DE AUTORIZAÃ‡Ã•ES PARA ADMIN
OBJETIVO: Tela para admin aprovar/rejeitar preÃ§os acima da tabela.

3.1. Nova Tela /templates/autorizacoes-preco.html
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” AutorizaÃ§Ãµes de PreÃ§o Pendentes                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Filtros: [Pendentes â–¼] Comprador: [Todos â–¼]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ”´ #001 - AGUARDANDO DECISÃƒO                    â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Comprador: JoÃ£o Silva                           â”‚    â”‚
â”‚  â”‚ Fornecedor: Sucatas XYZ (Tabela 1â˜…)            â”‚    â”‚
â”‚  â”‚ Material: PROCESSADOR CERÃ‚MICO A                â”‚    â”‚
â”‚  â”‚ Peso: 15 kg                                     â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ PreÃ§o Tabela: R$ 12,50/kg                       â”‚    â”‚
â”‚  â”‚ PreÃ§o Negociado: R$ 15,00/kg (+20%)            â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ Justificativa:                                  â”‚    â”‚
â”‚  â”‚ "Material de alta qualidade, cerÃ¢mica premium"  â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚ â”‚ ğŸ¯ DECISÃƒO                                â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ â—‹ Aprovar sem promoÃ§Ã£o                    â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ â— Aprovar e promover fornecedor para 2â˜…   â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ â—‹ Reprovar                                â”‚   â”‚    â”‚
â”‚  â”‚ â”‚                                            â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ Motivo: [_________________________]       â”‚   â”‚    â”‚
â”‚  â”‚ â”‚                                            â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ [âŒ Rejeitar] [âœ… Aprovar]                â”‚   â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
3.2. JavaScript
async function aprovarAutorizacao(id) {
    const promover = document.querySelector('input[name="decisao"]:checked').value === 'promover';
    const novaTabela = promover ? currentTabelaId + 1 : null;
    
    await fetch(`/api/autorizacoes-preco/${id}/aprovar`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
            promover_fornecedor: promover,
            nova_tabela_id: novaTabela,
            motivo_decisao: document.getElementById('motivo').value
        })
    });
    
    alert('AutorizaÃ§Ã£o aprovada! Fornecedor promovido para 2â˜…');
    carregarAutorizacoes();
}
4. IMPORTAÃ‡ÃƒO EM MASSA DE MATERIAIS
OBJETIVO: Permitir importar 150+ materiais via Excel de uma vez.

4.1. Template Excel
| Nome do Material              | ClassificaÃ§Ã£o | 1â˜… (R$/kg) | 2â˜… (R$/kg) | 3â˜… (R$/kg) |
|-------------------------------|---------------|------------|------------|------------|
| SUCATA PROCESSADOR CERÃ‚MICO A | pesado        | 12.50      | 15.00      | 18.50      |
| SUCATA PLACA MÃƒE SERVIDOR     | pesado        | 8.30       | 10.00      | 12.00      |
| SUCATA HD SATA                | medio         | 3.50       | 4.00       | 5.00       |
4.2. Endpoint de ImportaÃ§Ã£o (JÃ EXISTE)
# /api/materiais-base/importar-excel
# - Valida colunas
# - Cria materiais novos
# - Atualiza materiais existentes
# - Gera 3 preÃ§os por material
# - Retorna estatÃ­sticas
5. INTEGRAÃ‡ÃƒO FINAL NO FLUXO COMPLETO
FLUXO COMPLETO DO MÃ“DULO COMPRADOR:
1. ADM importa 50-150 materiais via Excel
   â†“
2. ADM configura preÃ§os base nas 3 tabelas (1â˜…, 2â˜…, 3â˜…)
   â†“
3. Fornecedor novo Ã© criado â†’ recebe Tabela 1â˜…
   â†“
4. Comprador vai em campo:
   - Seleciona fornecedor
   - Adiciona materiais (lista de 50+)
   - Sistema calcula valores automaticamente
   - Comprador pode negociar preÃ§o maior
   â†“
5. Se preÃ§o > tabela:
   - Sistema bloqueia
   - Cria solicitaÃ§Ã£o de autorizaÃ§Ã£o
   - Notifica admin via WebSocket
   â†“
6. Admin analisa:
   - Aprova â†’ libera compra
   - Aprova + Promove â†’ fornecedor sobe para 2â˜… ou 3â˜…
   - Rejeita â†’ comprador nÃ£o pode comprar com aquele valor
   â†“
7. Compra aprovada â†’ gera OC â†’ gera OS â†’ coleta â†’ conferÃªncia â†’ lote
ğŸ“ CHECKLIST DE IMPLEMENTAÃ‡ÃƒO
 Reformular /tipos-lote.html com cards de materiais
 Implementar modal de ediÃ§Ã£o com 3 inputs de preÃ§o
 Criar /templates/compra-rapida.html ou integrar em /funcionario.html
 Implementar seletor de fornecedor + materiais
 Adicionar validaÃ§Ã£o automÃ¡tica de preÃ§os
 Criar /templates/autorizacoes-preco.html
 Implementar aprovaÃ§Ã£o/rejeiÃ§Ã£o com promoÃ§Ã£o de fornecedor
 Adicionar notificaÃ§Ãµes WebSocket em tempo real
 Testar fluxo completo: importaÃ§Ã£o â†’ compra â†’ autorizaÃ§Ã£o â†’ aprovaÃ§Ã£o
 Documentar fluxo no README
ğŸ¨ DESIGN SYSTEM
Cores:

Verde primÃ¡rio: #059669 (aprovado)
Amarelo alerta: #f59e0b (pendente)
Vermelho: #ef4444 (acima da tabela)
Ãcones:

1â˜… = Tabela Base (verde claro)
2â˜… = Tabela IntermediÃ¡ria (amarelo)
3â˜… = Tabela Premium (dourado)
ğŸš€ PRÃ“XIMOS PASSOS
Implementar tela de materiais com visualizaÃ§Ã£o card-based
Criar fluxo de compra integrado com validaÃ§Ã£o
Desenvolver dashboard de autorizaÃ§Ãµes para admin
Testar fluxo end-to-end com dados reais
Documentar e treinar usuÃ¡rios
