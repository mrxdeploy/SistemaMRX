Objetivo da funcionalidade

Quando o motorista FINALIZA a OS, o sistema deve abrir automaticamente o fluxo de ConferÃªncia de Chegada.
Nesta etapa, um Conferente irÃ¡:

Validar a chegada do material

Realizar pesagem real

Conferir quantidade, tipo de material, qualidade, contaminaÃ§Ã£o, foto do material

Comparar com os valores previstos da OS/OC

Registrar divergÃªncias

Criar Lote e dar entrada no estoque

Gerar nÃ£o conformidade se divergÃªncia ultrapassar limite

Registrar trilha de auditoria completa

2. Endpoints a implementar
2.1 â€” Iniciar ConferÃªncia

POST /conferencia/{os_id}/iniciar

Somente permitido se OS.status == FINALIZADA

Cria registro com status PENDENTE

Carrega peso/quantidade prevista automaticamente da OC/OS

Registrar auditoria da criaÃ§Ã£o

2.2 â€” Registrar Pesagem e ConferÃªncia

PUT /conferencia/{id}/registrar

Payload esperado:

{
  "peso_real": 580,
  "quantidade_real": 120,
  "qualidade": "B",
  "fotos": ["file1.jpg", "file2.jpg"],
  "observacoes": "Material misturado com plÃ¡stico"
}


LÃ³gica obrigatÃ³ria:

Calcular automaticamente percentual_diferenca

Se percentual_diferenca > limite_configurado â†’ status = DIVERGENCIA

Enviar para analise ADM automaticamente (AGUARDANDO_ADM)

2.3 â€” DecisÃ£o ADM sobre divergÃªncia

PUT /conferencia/{id}/decisao-adm

AÃ§Ãµes possÃ­veis:

ACEITAR

ACEITAR_COM_DESCONTO

REJEITAR

Cada decisÃ£o deve:

Registrar auditoria (antes/depois, IP, GPS, device, user)

Ajustar valor e custo do lote quando necessÃ¡rio

Atualizar status da conferÃªncia

2.4 â€” Gerar Lote e Entrada de Estoque

Disparado automaticamente quando:

ConferÃªncia.status == APROVADO

Tipo divergÃªncia resolvida

POST /estoque/lotes/criar

Criar lote com:

vinculo com conferÃªncia

quantidade final aceita

custo unitÃ¡rio

material

origem (OS > OC > SC)

snapshot de qualidade

metadata da pesagem

ApÃ³s criar lote:

POST /estoque/entrada
Registrar entrada efetiva no WMS interno.

ğŸ–¥ 3. UI Web â€” Telas do Conferente
â¤ No menu administrativo, adicionar nova seÃ§Ã£o: â€œğŸ“¦ Recebimento / ConferÃªnciaâ€

Dentro dela:

Tela 1 â€” Lista de ConferÃªncias Pendentes

Mostrar:

OS

OC

Fornecedor

Peso previsto

Status

BotÃ£o â€œIniciar conferÃªnciaâ€

Filtro por status (PENDENTE, DIVERGENCIA, AGUARDANDO ADM)

Tela 2 â€” FormulÃ¡rio de ConferÃªncia (tela principal)

Elementos obrigatÃ³rios:

Bloco superior com dados da OS/OC

Campo para registrar peso real

Campo para registrar quantidade real

Campo â€œQualidadeâ€ com opÃ§Ãµes A/B/C/DescartÃ¡vel

Upload de fotos

Campo observaÃ§Ãµes

BotÃ£o â€œRegistrar ConferÃªnciaâ€

ApÃ³s registrar:

Se divergÃªncia â†’ tela exibe mensagem â€œDivergÃªncia detectada â€” Aguardando ADMâ€

Tela 3 â€” Tela ADM: DecisÃ£o sobre divergÃªncias

Exibir:

Valores previstos vs recebidos

CÃ¡lculo do percentual de diferenÃ§a

Fotos da pesagem

BotÃµes:

ACEITAR

ACEITAR COM DESCONTO

REJEITAR

Campo de texto obrigatÃ³rio: â€œMotivo da decisÃ£oâ€

Resultado:

Lote criado automaticamente (se aceito)

Estoque atualizado

ğŸ” 4. Regras obrigatÃ³rias da LÃ³gica de NegÃ³cio
âœ” DivergÃªncia Ã© calculada automaticamente:
percentual_diferenca = (peso_real - peso_previsto) / peso_previsto * 100

âœ” Se divergÃªncia > limite_configurado (ex: 10%):

ConferÃªncia.status = DIVERGENCIA

Notificar ADM automaticamente

Impedir entrada no estoque atÃ© decisÃ£o

âœ” Caso conferÃªncia seja rejeitada:

NÃ£o gerar lote

Notificar comprador e financeiro

âœ” Todo evento deve registrar:

GPS do dispositivo do conferente

IP da mÃ¡quina

device_id

timestamp

usuÃ¡rio ativo

ğŸ“¸ 5. Anexos e evidÃªncias

Upload de fotos deve ser feito via URL prÃ©-assinada (pre-signed URL)

MÃ­nimo 1 foto obrigatÃ³ria quando houver divergÃªncia

Armazenamento em pasta: /evidencias/conferencia/{id}/

ğŸ§ª 6. QA e Casos de Teste ObrigatÃ³rios
âœ” Caso de teste 1: Pesagem sem divergÃªncia

Entrada:

Previsto: 1000 kg

Real: 980 kg

DiferenÃ§a: 2%

Resultado esperado:

NÃ£o gera divergÃªncia

Cria lote automaticamente

Estoque atualizado

âœ” Caso de teste 2: Pesagem com divergÃªncia leve (< limite)

Previsto: 1000 kg

Real: 1040 kg

DiferenÃ§a: 4%

Resultado:

Sinaliza divergÃªncia leve

ADM ainda pode aceitar sem desconto

âœ” Caso de teste 3 (OBRIGATÃ“RIO): divergÃªncia severa > limite

Previsto: 1000 kg

Real: 1200 kg

DiferenÃ§a: 20%

Resultado:

ConferÃªncia.status = DIVERGENCIA

NÃ£o conformidade registrada

Enviar para ADM

ADM Aprovando com desconto â†’ recalcular custo

ADM Rejeitando â†’ bloquear lote

âœ” 7. CritÃ©rios de aceite finais

Para concluir esta entrega, o sistema deve permitir:

 Abrir conferÃªncia automaticamente apÃ³s OS finalizada

 Registrar pesagem + qualidade + fotos

 Detectar divergÃªncia automaticamente

 Enviar divergÃªncia > limite para ADM

 ADM pode aceitar / aceitar com desconto / rejeitar

 Criar lote automÃ¡tico apÃ³s decisÃ£o

 Dar entrada em estoque com custo adequado

 Registrar auditoria + GPS + device + IP

 UI completa para conferente e ADM

 Testes QA comprovando todos os cenÃ¡rios