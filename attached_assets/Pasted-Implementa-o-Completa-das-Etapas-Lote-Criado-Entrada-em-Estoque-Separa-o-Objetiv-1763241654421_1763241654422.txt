Implementa√ß√£o Completa das Etapas:

üìå Lote Criado ‚Üí üìå Entrada em Estoque ‚Üí üìå Separa√ß√£o**

Objetivo geral: Implementar integralmente o fluxo p√≥s-recebimento, adicionando cria√ß√£o de Lote, entrada autom√°tica no estoque e m√≥dulo completo de Separa√ß√£o, com rastreabilidade, auditoria, permiss√µes e gera√ß√£o de sublotes.
Essa entrega deve funcionar em conjunto com SC ‚Üí OC ‚Üí OS ‚Üí Confer√™ncia j√° implementados.

üî∂ 1. Criar M√≥dulo de Lote (Lote Criado)
Objetivo

Implementar a cria√ß√£o autom√°tica de Lote ap√≥s a Confer√™ncia de Chegada (pesagem e qualidade), atendendo √†s exig√™ncias do MRX_Gest√£o.

Requisitos funcionais

Quando a OS for FINALIZADA e a Confer√™ncia registrada:

Criar automaticamente um Lote com:

id

numero_lote (sequencial YYYY-XXXXX)

origem (SC/OC/OS)

fornecedor

material

peso_bruto_recebido

peso_liquido (se houver desconto de impureza)

qualidade_recebida

data_criacao

conferente_id

anexos (fotos de pesagem, fotos de chegada, documentos)

Registrar diverg√™ncias:

peso_previsto vs peso_recebido

quantidade prevista vs recebida

qualidade informada vs conferida
Se diverg√™ncia > limite definido, marcar lote como PENDENTE_ADM e gerar Notifica√ß√£o + Registro de N√£o Conformidade.

Auditoria obrigat√≥ria:

registrar ip, device_id, gps, usu√°rio, timestamp.

Endpoints

POST /lotes (cria√ß√£o autom√°tica)

GET /lotes (filtros: data, fornecedor, diverg√™ncia, status)

GET /lotes/{id} (detalhes do lote, anexos, hist√≥rico)

UI/UX

Painel administrativo:

Nova tela Lotes Recebidos

Cores por status: normal, divergente, bloqueado, aguardando separa√ß√£o

Visualiza√ß√£o de anexos e do hist√≥rico completo

üî∂ 2. Entrada em Estoque (WMS ‚Äî Entrada Inicial)
Objetivo

Registrar automaticamente o Lote rec√©m-criado como uma Entrada de Estoque, seguindo o blueprint WMS do arquivo md.

Requisitos funcionais

Ao criar o lote:

gerar automaticamente registro de entrada de estoque:

lote_id

localizacao_inicial (P√ÅTIO RECEBIMENTO / DOCK 01 ou equivalente)

quantidade/peso

tipo: "ENTRADA_RECEBIMENTO"

usu√°rio respons√°vel

data/hora

Regras obrigat√≥rias:

Lote com diverg√™ncia significativa ‚Üí n√£o entra no estoque final at√© ADM resolver

Lote pode ser bloqueado para QC ou invent√°rio

Manter hist√≥rico de movimenta√ß√µes (WMS)

Permitir pol√≠ticas futuras de FIFO / FEFO

Auditoria:

Cada movimenta√ß√£o gera registro com before/after.

Endpoints

POST /estoque/entrada (chamado internamente ao criar lote)

GET /estoque/lotes

GET /estoque/movimentacoes

UI/UX

Nova tela Estoque ‚Üí Lotes Ativos

Localiza√ß√£o atual

Status (bloqueado, livre, aguardando separa√ß√£o)

Hist√≥rico de movimenta√ß√µes

Filtro por material, data, origem, diverg√™ncia

üî∂ 3. M√≥dulo Completo de Separa√ß√£o (Workflow de Separa√ß√£o)
Objetivo

Implementar o workflow de separa√ß√£o solicitado no MRX_Gest√£o, permitindo transformar o lote bruto em sublotes, res√≠duos e materiais classificados.

Requisitos funcionais ‚Äî Fluxo principal

Lote que entrou no estoque deve aparecer em:

Fila de Separa√ß√£o (status: AGUARDANDO_SEPARACAO)

Tela principal de separa√ß√£o com:

informa√ß√µes do lote

peso recebido

qualidade

anexos

conferente e data

bot√£o Iniciar Separa√ß√£o

Etapas da separa√ß√£o:

Desmontagem / triagem / classifica√ß√£o

Cria√ß√£o de sublotes:

material

peso

quantidade

qualidade

observa√ß√µes

fotos opcional

Res√≠duos:

res√≠duos devem ser classificados e registrados

n√£o podem ser descartados sem ADM

justificativa obrigat√≥ria

Finaliza√ß√£o:

sistema gera automaticamente:

novos lotes filhos

movimenta√ß√£o de estoque

registro de produtividade

percentual de aproveitamento

lote original √© marcado como PROCESSADO

Auditoria completa:

in√≠cio da separa√ß√£o (gps, ip, user)

cada cria√ß√£o de sublote

cria√ß√£o de res√≠duos

finaliza√ß√£o

Permiss√µes

Somente OPERADOR_SEPARACAO pode separar

Somente ADMINISTRADOR pode autorizar descarte

Somente QA pode bloquear/desbloquear lotes

EndPoints

GET /separacao/fila

POST /separacao/{lote_id}/iniciar

POST /separacao/{lote_id}/sublotes

POST /separacao/{lote_id}/residuos

POST /separacao/{lote_id}/finalizar

POST /residuos/{id}/aprovar-adm

UI/UX

Criar tr√™s novas telas:

1. ‚ÄúFila de Separa√ß√£o‚Äù

Lista todos os lotes aguardando separa√ß√£o

Bot√£o Abrir lote

2. ‚ÄúTela de Separa√ß√£o (workflow)‚Äù

Cabe√ßalho com informa√ß√µes do lote

Cards para:

checklist de qualidade

pesagem da separa√ß√£o

cria√ß√£o de sublotes

registro de res√≠duos

Bot√£o Finalizar Separa√ß√£o (bloqueado at√© todos campos obrigat√≥rios serem preenchidos)

3. ‚ÄúPainel de Descarte (ADM)‚Äù

Lotes com res√≠duos pendentes

Bot√£o Aprovar / Rejeitar Descarte

Justificativa obrigat√≥ria

Crit√©rios de Aceite

Criar lote automaticamente ap√≥s confer√™ncia da OS

Entrada autom√°tica em estoque

Workflow completo de Separa√ß√£o funcionando

Cria√ß√£o de sublotes e res√≠duos

Autoriza√ß√£o necess√°ria para descarte

Auditoria completa e rastre√°vel

Hist√≥rico do lote deve mostrar cadeia completa:

SC ‚Üí OC ‚Üí OS ‚Üí Confer√™ncia ‚Üí Lote ‚Üí Separa√ß√£o ‚Üí Sublotes

Telas prontas e responsivas

Testes unit√°rios e integra√ß√£o

QA & Testes exigidos

Criar lote e verificar diverg√™ncia

Testar bloqueio de lote divergente

Simular separa√ß√£o gerando tr√™s sublotes e um res√≠duo

Verificar que descarte n√£o funciona sem ADM

Verificar auditoria de cada etapa

Validar movimenta√ß√µes internas WMS